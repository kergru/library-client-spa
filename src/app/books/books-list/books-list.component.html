<div class="container mt-5">
  <div class="row mb-4">
    <div class="col">
      <h1>B√ºcher in der Bibliothek</h1>
    </div>
  </div>

  <!-- üîç Suchleiste -->
  <div class="row mb-4">
    <div class="col-md-6">
      <form (ngSubmit)="onSearch()" class="search-form">
        <div class="input-group">
          <input
            type="text"
            class="form-control"
            [(ngModel)]="searchTerm"
            name="search"
            placeholder="Suche nach Titel, Autor oder ISBN..."
          />
          <button class="btn btn-primary" type="submit">Suchen</button>
        </div>
      </form>
    </div>
  </div>

  <!-- üìö B√ºcherliste -->
  @if (state$ | async; as s) {
    @if (s.loading) {
      <div class="alert alert-info">B√ºcher werden geladen...</div>
    } @else if (s.error) {
      <div class="alert alert-danger">Fehler: {{ s.error }}</div>
    } @else if (s.page && s.page.content.length > 0) {
      <table class="table table-striped">
        <thead>
        <tr>
          <th>Titel</th>
          <th>Autor</th>
          <th>ISBN</th>
          <th>Status</th>
          <th>Aktionen</th>
        </tr>
        </thead>
        <tbody>
          @for (book of s.page.content; track book.isbn) {
            <tr>
              <td>{{ book.title || 'Ohne Titel' }}</td>
              <td>{{ book.author || 'Unbekannter Autor' }}</td>
              <td>{{ book.isbn }}</td>
              <td>
                @if (book.loanStatus?.available) {
                  <span class="badge bg-success">Verf√ºgbar</span>
                } @else {
                  <span class="badge bg-danger">Ausgeliehen</span>
                }
              </td>
              <td>
                <a
                  [routerLink]="['/books', book.isbn]"
                  class="btn btn-sm btn-outline-primary"
                >
                  Details
                </a>
              </td>
            </tr>
          }
        </tbody>
      </table>

      <!-- üìÑ Pagination -->
      <nav aria-label="Seiten-Navigation" class="mt-4">
        <ul class="pagination justify-content-center">

          <!-- ‚è™ Zur√ºck -->
          <li class="page-item" [class.disabled]="s.page.first">
            <a class="page-link" (click)="changePage(s.page.number - 1)">&laquo;</a>
          </li>

          <!-- Seitenzahlen -->
          <li
            *ngFor="let p of getPagesArray(s.page.totalPages); let i = index"
            class="page-item"
            [class.active]="i === s.page.number"
          >
            <a class="page-link" (click)="changePage(i)">{{ i + 1 }}</a>
          </li>

          <!-- ‚è© Weiter -->
          <li class="page-item" [class.disabled]="s.page.last">
            <a class="page-link" (click)="changePage(s.page.number + 1)">&raquo;</a>
          </li>
        </ul>
      </nav>
    } @else {
      <div class="alert alert-warning">Keine B√ºcher gefunden.</div>
    }
  }
</div>
